<Window x:Class="SmtpTesterWpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="SMTP Tester" Height="780" Width="1140"
        WindowStartupLocation="CenterScreen"
        TextElement.FontFamily="Segoe UI"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        Foreground="{DynamicResource MaterialDesignBody}"
        Background="{DynamicResource MaterialDesignPaper}">


    <DockPanel>
        <!-- App Bar -->
        <Grid DockPanel.Dock="Top" Background="{DynamicResource PrimaryHueMidBrush}" Height="52">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="16,0,0,0">
                <materialDesign:PackIcon Kind="EmailSendOutline" Width="24" Height="24" Foreground="Black" Margin="0,0,8,0"/>
                <TextBlock Text="SMTP Tester" FontSize="18" FontWeight="SemiBold" Foreground="Black" VerticalAlignment="Center"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,12,0">
                <Button Content="Probe" Click="Probe_Click" Margin="6,0"
                Style="{DynamicResource MaterialDesignRaisedButton}" Foreground="White"/>
                <Button Content="Send Test" Click="Send_Click" Margin="6,0"
                Style="{DynamicResource MaterialDesignRaisedButton}" Foreground="White"/>
                <Button Content="Test All TLS" Click="TestAll_Click" Margin="6,0"
                Style="{StaticResource MaterialDesignOutlinedButton}"/>
                <Button Content="Save Profile" Click="SaveProfile_Click" Margin="18,0,6,0"
                Style="{StaticResource MaterialDesignOutlinedButton}"/>
                <Button Content="Load Profile" Click="LoadProfile_Click" Margin="6,0"
                Style="{StaticResource MaterialDesignOutlinedButton}"/>
                <Button Content="Clear Log" Click="ClearLog_Click" Margin="18,0,0,0"
                Style="{StaticResource MaterialDesignOutlinedButton}"/>
                <!-- NEW: Cancel -->
                <Button Content="Cancel" Click="Cancel_Click" Margin="6,0"
                Style="{StaticResource MaterialDesignOutlinedButton}"/>
                <TextBlock Text="Show log"
           Foreground="Black"
           VerticalAlignment="Center"
           Margin="12,0,6,0"/>
                <ToggleButton x:Name="ShowLogToggle"
              Style="{StaticResource MaterialDesignSwitchToggleButton}"
              ToolTip="Show/Hide the log panel"
              Checked="ShowLogToggle_Checked"
              Unchecked="ShowLogToggle_Unchecked"/>
                <TextBlock Text="Dark" Foreground="Black" VerticalAlignment="Center" Margin="12,0,4,0"/>
                <ToggleButton x:Name="DarkToggle"
              Style="{StaticResource MaterialDesignSwitchToggleButton}"
              ToolTip="Toggle dark theme"
              Checked="DarkToggle_Checked"
              Unchecked="DarkToggle_Unchecked"/>
            </StackPanel>
        </Grid>

        <!-- Main content (no outer ScrollViewer) -->
        <Grid Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- cards row -->
                <RowDefinition x:Name="LogRow" Height="*"/>
                <!-- log row -->
            </Grid.RowDefinitions>

            <!-- Cards row -->
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Connection Card -->
                <materialDesign:Card Grid.Column="0" Margin="0,0,12,12" Padding="12"
                      materialDesign:ElevationAssist.Elevation="Dp3">
                    <Grid>
                        <!-- rows: title, host/port, tls/timeout, EHLO, skip-cert, log-to-file+path -->
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Connection" FontWeight="SemiBold" Margin="4,0,0,8" Grid.ColumnSpan="2"/>

                        <!-- Row 1: Host + Port -->
                        <TextBox x:Name="HostBox" Grid.Row="1" Grid.Column="0"
             Margin="0,0,8,8" MinWidth="300"
             Style="{StaticResource MaterialDesignOutlinedTextBox}"
             materialDesign:HintAssist.Hint="Host"/>
                        <TextBox x:Name="PortBox" Grid.Row="1" Grid.Column="1"
             Margin="0,0,0,8" MinWidth="110" Text="587"
             Style="{StaticResource MaterialDesignOutlinedTextBox}"
             materialDesign:HintAssist.Hint="Port"/>

                        <!-- Row 2: TLS + Timeout -->
                        <ComboBox x:Name="TlsBox" Grid.Row="2" Grid.Column="0"
              Margin="0,0,8,8" SelectedIndex="1"
              Style="{StaticResource MaterialDesignOutlinedComboBox}"
              materialDesign:HintAssist.Hint="TLS Mode">
                            <ComboBoxItem Content="none"/>
                            <ComboBoxItem Content="starttls"/>
                            <ComboBoxItem Content="ssl"/>
                        </ComboBox>
                        <TextBox x:Name="TimeoutBox" Grid.Row="2" Grid.Column="1"
             Margin="0,0,0,8" Text="20000"
             Style="{StaticResource MaterialDesignOutlinedTextBox}"
             materialDesign:HintAssist.Hint="Timeout (ms)"/>

                        <!-- Row 3: EHLO -->
                        <TextBox x:Name="EhloBox" Grid.Row="3" Grid.ColumnSpan="2"
             Margin="0,0,0,8"
             Style="{StaticResource MaterialDesignOutlinedTextBox}"
             materialDesign:HintAssist.Hint="EHLO domain (optional)"/>

                        <!-- Row 4: Skip cert (full width, its own row) -->
                        <CheckBox x:Name="SkipCertCheck" Grid.Row="4" Grid.ColumnSpan="2"
              VerticalAlignment="Center"
              Content="Skip certificate validation (testing only)"/>

                        <!-- Row 5: Log to file + path (full width) -->
                        <Grid Grid.Row="5" Grid.ColumnSpan="2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <CheckBox x:Name="LogToFileCheck" Grid.Column="0"
                VerticalAlignment="Top" Content="Log to file" Margin="0,32,0,0"/>

                            <TextBox x:Name="LogPathBox" Grid.Column="1"
               Margin="10,16,0,-16" MinWidth="340"
               IsEnabled="{Binding IsChecked, ElementName=LogToFileCheck}"
               Style="{StaticResource MaterialDesignOutlinedTextBox}"
               materialDesign:HintAssist.Hint="Log path"
               Text="smtp-protocol.log"/>
                        </Grid>
                    </Grid>
                </materialDesign:Card>

                <!-- Authentication Card -->
                <materialDesign:Card Grid.Column="1" Margin="6,0,6,12" Padding="12"
                              materialDesign:ElevationAssist.Elevation="Dp3">
                    <StackPanel>
                        <TextBlock Text="Authentication" FontWeight="SemiBold" Margin="4,0,0,8"/>
                        <TextBox x:Name="UserBox"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     materialDesign:HintAssist.Hint="Username (leave blank to skip AUTH)"/>
                        <PasswordBox x:Name="PassBox" Margin="0,8,0,0"
                         Style="{StaticResource MaterialDesignOutlinedPasswordBox}"
                         materialDesign:HintAssist.Hint="Password"/>
                        <CheckBox x:Name="SendByDefault" Margin="0,8,0,0"
                      Content="Send message after probe by default"/>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Message Card -->
                <materialDesign:Card Grid.Column="2" Margin="12,0,0,12" Padding="12"
                              materialDesign:ElevationAssist.Elevation="Dp3">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="Message" FontWeight="SemiBold" Margin="4,0,0,8"/>

                        <TextBox x:Name="FromBox" Grid.Row="1"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     materialDesign:HintAssist.Hint="From"/>

                        <TextBox x:Name="ToBox" Grid.Row="2" Margin="0,8,0,0"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     materialDesign:HintAssist.Hint="To (comma/semicolon separated)"/>

                        <TextBox x:Name="SubjectBox" Grid.Row="3" Margin="0,8,0,0"
                     Text="SMTP tester"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     materialDesign:HintAssist.Hint="Subject"/>

                        <Grid Grid.Row="4" Margin="0,8,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBox x:Name="BodyBox"
                       AcceptsReturn="True" Height="96"
                       Style="{StaticResource MaterialDesignOutlinedTextBox}"
                       materialDesign:HintAssist.Hint="Body"
                       Text="This is a test message."/>

                            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,8,0,4">
                                <Button Content="Add attachment..." Width="140" Margin="0,0,8,0"
                        Style="{StaticResource MaterialDesignOutlinedButton}"
                        Click="AddAttachment_Click"/>
                                <Button Content="Remove selected" Width="150"
                        Style="{StaticResource MaterialDesignOutlinedButton}"
                        Click="RemoveAttachment_Click"/>
                            </StackPanel>

                            <ListBox x:Name="AttachList" Grid.Row="2" Height="80"/>
                        </Grid>
                    </Grid>
                </materialDesign:Card>
            </Grid>

            <!-- Log Card (only this area scrolls) -->
            <materialDesign:Card x:Name="LogCard"  Grid.Row="1" Padding="12" materialDesign:ElevationAssist.Elevation="Dp3">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Header row with controls on the right -->
                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Protocol &amp; Status Log" FontWeight="SemiBold" Margin="4,0,0,8"/>

                        <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                            <!-- NEW: Auto-scroll toggle -->
                            <CheckBox Content="Auto-scroll" Margin="0,0,8,0" IsChecked="True"
                        Checked="AutoScroll_On" Unchecked="AutoScroll_Off"/>
                            <!-- NEW: Copy log -->
                            <Button Content="Copy log" Click="CopyLog_Click"
                      Style="{StaticResource MaterialDesignOutlinedButton}"/>
                        </StackPanel>
                    </Grid>

                    <!-- Scroll only the log -->
                    <ScrollViewer Grid.Row="1"
                        VerticalScrollBarVisibility="Auto"
                        HorizontalScrollBarVisibility="Auto">
                        <TextBox x:Name="LogBox"
                     FontFamily="Consolas" FontSize="12"
                     IsReadOnly="True" AcceptsReturn="True"
                     TextWrapping="NoWrap"
                     VerticalScrollBarVisibility="Auto"
                     HorizontalScrollBarVisibility="Auto"/>
                    </ScrollViewer>
                </Grid>
            </materialDesign:Card>
            <materialDesign:Snackbar x:Name="MainSnackbar"
     Grid.RowSpan="2"
     Margin="16"
     HorizontalAlignment="Right"
     VerticalAlignment="Bottom"/>
        </Grid>
    </DockPanel>
</Window>
